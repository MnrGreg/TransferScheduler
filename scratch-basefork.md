# start server
anvil --base-fee 7 --fork-url https://mainnet.base.org

# Base ERC20 contract addresses
USDC_CONTRACT=0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
USDC_HOLDER=0x0B0A5886664376F59C351ba3f598C8A8B4D0A6f3
WETH_CONTRACT=0x4200000000000000000000000000000000000006

# Anvil wallet addresses
ADDRESS=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
ADDRESSKEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
SIGNER=0xa0Ee7A142d267C1f36714E4a8F75612F20a79720
SIGNERKEY=0x2a871d0798f97d79848a013d4936a73bf4cc922c825d33c1cf7073dff6d409c6
RELAYKEY=0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6
TS=0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
TSKEY=0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a
PRIVATE_KEY=0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a

ANVILCCREATE2=0x4e59b44847b379578588920ca78fbf26c0b4956c
TSCONTRACT=0x27481fE1C63Cb6edaD59D0Cd65E95cA5676dc9eb


forge inspect contracts/src/TransferSchedulerV1.sol:TransferSchedulerV1 abi > ./client/transferSchedulerABI.json

forge inspect contracts/src/transferSchedulerV1.sol:TransferSchedulerV1 abi --pretty
forge inspect contracts/src/transferSchedulerV1.sol:TransferSchedulerV1 storage --pretty
forge inspect contracts/src/transferSchedulerV1.sol:TransferSchedulerV1 methods --pretty
forge inspect contracts/src/transferSchedulerV1.sol:TransferSchedulerV1 errors --pretty


# Check TransferScheduler spender balance on address funds
cast call -v $USDC_CONTRACT "allowance(address owner, address spender)" $ADDRESS $TSCONTRACT
cast call -v $WETH_CONTRACT "allowance(address owner, address spender)" $ADDRESS $TSCONTRACT

# Approve TransferScheduler contract to spend behalf of address
cast send -vv $WETH_CONTRACT "approve(address spender, uint256 amount)" $TSCONTRACT 50000000000000000000  \
    --private-key $ADDRESSKEY
cast send -vv $USDC_CONTRACT "approve(address spender, uint256 amount)" $TSCONTRACT 99000000  \
    --private-key $ADDRESSKEY  

# QueueTransfer
cast send -v --private-key $ADDRESSKEY $TSCONTRACT "queueScheduledTransfer(address,uint256,address,address,uint256,uint256,uint256,uint256,bytes)" \
  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266  \
  13685400630604971251 \
  0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913 \
  0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 \
  45  \
  1734450660 \
  1734536880 \
  150000 \
  0xfed635e9e6f0ee909ec7909efc5022c786d0630352e9239e4ef60f89e0db3bdb23ab2dcc7000291bd7c5fdff06579dd6a729c8c6ba83ae5b27b4cf7309ed76c81b


# ExecuteTransfer

{"owner":"0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266","nonce":"7013926005524616775","token":"0xA15BB66138824a1c7167f5E85b957d04Dd34E468","to":"0xa0Ee7A142d267C1f36714E4a8F75612F20a79720","amount":"5000000000000000000","notBeforeDate":"1723107210","notAfterDate":"1743107210","maxBaseFee":"150000","signature":"0x246122f3228ce7015599ea780e1579dc2607d13f044e4414be7f2f3cc91c00b8388a0d6c2bd1152b7a867ccd4b39e9efeb78cf5cf7fd640849b86ab8aa396a521c"}


cast send -v --private-key $RELAYKEY $TSCONTRACT "executeTransfer(address,uint256,address,address,uint256,uint256,uint256,uint256,bytes)"  \
  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266  \
  7013926005524616775  \
  0xA15BB66138824a1c7167f5E85b957d04Dd34E468  \
  0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 \
  5000000000000000000 \
  1753107210  \
  1743107210  \
  150000 \
  0x246122f3228ce7015599ea780e1579dc2607d13f044e4414be7f2f3cc91c00b8388a0d6c2bd1152b7a867ccd4b39e9efeb78cf5cf7fd640849b86ab8aa396a521c


cast send -vvvvv --private-key $RELAYKEY $TSCONTRACT \
0xbb78fdd1000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb922660000000000000000000000000000000000000000000000000000000aae456654000000000000000000000000700b6a60ce7eaaea56f065753d8dcb9653dbad350000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc0000000000000000000000000000000000000000000000004563918244f40000000000000000000000000000663f3ad617193148711d28f5334ee4ed0701660200000000000000000000000000000000000000000000000000000000000249f0000000000000000000000000000000000000000000000000000000006592542e0000000000000000000000000000000000000000000000000000000069560cae00000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000041eb2df71dbe21f3a98d6da6dd9fa9ef88a39604814e12a1a48a57511b2b58642b631fa2f1b4bdb4c96da8c99d5d12ff5df67ecca20ce7d95b0244d49d56e197ec1b00000000000000000000000000000000000000000000000000000000000000



# getTransfers
ADDRESS=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
 



cast abi-decode "getScheduledTransfers(address,bool)((uint96,uint40))" \
0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000d8ca8041ed5e2a9f00000000000000000000000000000000000000000000000000000000016cbe39000000000000000000000000000000000000000000000000d8ca8041ed5e2a9f00000000000000000000000000000000000000000000000000000000016cbe39000000000000000000000000000000000000000000000000bcad8eb553d4db7700000000000000000000000000000000000000000000000000000000016cbe79000000000000000000000000000000000000000000000000bcad8eb553d4db7700000000000000000000000000000000000000000000000000000000016cbe79000000000000000000000000000000000000000000000000bcb766be1779c3b400000000000000000000000000000000000000000000000000000000016cbe79000000000000000000000000000000000000000000000000bcb766be1779c3b400000000000000000000000000000000000000000000000000000000016cbe79

cast abi-decode "getScheduledTransfers(address,bool)((uint96,uint40))" \
0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000016921a77019d655f00000000000000000000000000000000000000000000000000000000016cbe6a00000000000000000000000000000000000000000000000016921a77019d655f00000000000000000000000000000000000000000000000000000000016cbe6a

cast abi-decode "getScheduledTransfers(address,bool)((uint96,uint40))" \
0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000016921a77019d655f00000000000000000000000000000000000000000000000000000000016cbe6a00000000000000000000000000000000000000000000000016921a77019d655f00000000000000000000000000000000000000000000000000000000016cbe6a0000000000000000000000000000000000000000000000001d90d775a002189200000000000000000000000000000000000000000000000000000000016cbefa0000000000000000000000000000000000000000000000001d90d775a002189200000000000000000000000000000000000000000000000000000000016cbefa

cast abi-decode "getScheduledTransfers(address,bool)((uint96,uint40))" \
0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000d8ca8041ed5e2a9f00000000000000000000000000000000000000000000000000000000016cbe39000000000000000000000000000000000000000000000000d8ca8041ed5e2a9f00000000000000000000000000000000000000000000000000000000016cbe39000000000000000000000000000000000000000000000000bcad8eb553d4db7700000000000000000000000000000000000000000000000000000000016cbe79000000000000000000000000000000000000000000000000bcad8eb553d4db7700000000000000000000000000000000000000000000000000000000016cbe79000000000000000000000000000000000000000000000000bcb766be1779c3b400000000000000000000000000000000000000000000000000000000016cbe79000000000000000000000000000000000000000000000000bcb766be1779c3b400000000000000000000000000000000000000000000000000000000016cbe790000000000000000000000000000000000000000000000001d90d775a002189200000000000000000000000000000000000000000000000000000000016cbefa0000000000000000000000000000000000000000000000001d90d775a002189200000000000000000000000000000000000000000000000000000000016cbefa

# getGasToken
cast call -v $TSCONTRACT "getGasToken()"
cast call -v $TSCONTRACT "getGasCommissionPercentage()"


# Get logs
cast logs --from-block 89 --to-block latest  --address $TSCONTRACT
cast create2 --starts-with feed


cast rpc anvil_setBalance ${ADDRESS} 10000000000000000000
cast rpc anvil_impersonateAccount ${USDC_HOLDER}
cast send --from ${USDC_HOLDER} ${USDC_CONTRACT} "transfer(address,uint256)(bool)" ${ADDRESS} 100000000000 --unlocked
cast send --from ${ADDRESS} -vv ${USDC_CONTRACT} "approve(address spender, uint256 amount)" ${TSCONTRACT} 100000000000  --unlocked
cast send -vv ${WETH_CONTRACT} "approve(address spender, uint256 amount)" ${TSCONTRACT} 1000000000000000000  --private-key ${ADDRESSKEY}
cast send -vv ${USDC_CONTRACT} "approve(address spender, uint256 amount)" ${TSCONTRACT} 100000000  --private-key ${ADDRESSKEY}

cast rpc anvil_stopImpersonatingAccount ${USDC_HOLDER}

cast rpc eth_chainId
anvil_setChainId

cast rpc eth_getBalance "${ADDRESS}" "latest"

cast rpc eth_feeHistory "4" "4" "4"

cast basefee  
cast gas-price # current gas price in Wei (BaseFee + Tip)

cast rpc anvil_setMinGasPrice
cast rpc anvil_setNextBlockBaseFeePerGas



cast rpc eth_gasPrice

cast rpc eth_feeHistory '[1, "latest", []]'